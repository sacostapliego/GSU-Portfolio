<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Play - Santa's Adaptive Christmas Fifteen Puzzle</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
<!-- Background Christmas Music (Loops Continuously) -->
<audio id="bg-music" loop>
    <source src="assets/christmas.mp3" type="audio/mpeg">
    <source src="assets/christmas.wav" type="audio/wav">
    <source src="assets/christmas.ogg" type="audio/ogg">
</audio>

<!-- Music Control Button and Volume Slider -->
<div class="music-controls">
    <button id="music-toggle" class="music-btn" title="Toggle Music">ğŸ”Š</button>
    <input type="range" id="volume-slider" class="volume-slider" min="0" max="100" value="15" title="Volume Control">
</div>
<header>
    <div class="snowfall"></div>
    <h1>ğŸ… Santa's Adaptive Christmas Fifteen Puzzle ğŸ„</h1>
    <nav>
        <a href="index_demo.html">ğŸ  Home</a> |
        <a href="game_demo.html">ğŸ® Play</a>
        <button id="theme-toggle" style="float:right;margin-left:2em;">ğŸŒ™ Switch Theme</button>
    </nav>
</header>
<main>
    <div class="decoration">ğŸ„ â›„ ğŸ„</div>
    <div id="game-board"></div>
    <div id="game-ui">
        <span id="timer">â±ï¸ 00:00</span>
        <span id="move-counter">ğŸ“Š Moves: 0</span>
        <span id="stage-indicator" style="margin-left:1em;">ğŸ¯ Stage: 1 | Difficulty: Easy</span>
        <div style="margin-top: 1.5em;">
            <button id="reset-btn">ğŸ”„ Reset</button>
            <button id="newgame-btn">âœ¨ New Game</button>
            <button id="miracle-btn">ğŸ„ Christmas Miracle</button>
            <span id="miracle-lives" style="margin-left:0.5em;">â¤ï¸ 2</span>
            <button id="freeze-btn">â„ï¸ Freeze Timer</button>
            <button id="shuffle-btn">ğŸ”€ Mini Shuffle</button>
            <button id="solve-btn">âœ… Solve Automatically</button>
            <select id="stage-select" style="margin-left:1em;">
                <option value="1">Stage 1</option>
                <option value="2">Stage 2</option>
                <option value="3">Stage 3</option>
                <option value="4">Stage 4</option>
                <option value="5">Stage 5</option>
            </select>
        </div>
    </div>
    <div class="decoration">ğŸ ğŸ… ğŸ¦Œ ğŸ… ğŸ</div>

    <div id="results-overlay" class="results-overlay hidden">
        <div class="results-card">
            <h2>ğŸ‰ Puzzle Solved!</h2>
            <div class="results-stats">
                <span id="res-time">Time: --</span>
                <span id="res-moves">Moves: --</span>
                <span id="res-difficulty">Difficulty: --</span>
            </div>
            <div class="results-story">
                <h3 id="res-story-title"></h3>
                <p id="res-story-text"></p>
            </div>
            <div id="res-image" class="results-image"></div>
            <div style="margin-top:1.2em;">
                <button id="close-results" class="start-btn">Play Again</button>
            </div>
        </div>
    </div>
</main>
<footer>
    <p>&copy; 2025 Santa's Workshop. All rights reserved.</p>
</footer>
<script src="js/game.js"></script>
<script>
// Theme toggle logic and Background Music Control
document.addEventListener('DOMContentLoaded', function() {
    const btn = document.getElementById('theme-toggle');
    const bgMusic = document.getElementById('bg-music');
    const musicToggle = document.getElementById('music-toggle');
    const volumeSlider = document.getElementById('volume-slider');
    
    // Theme toggle
    function setTheme(theme) {
        document.body.classList.toggle('theme-dark', theme === 'dark');
        localStorage.setItem('theme', theme);
    }
    const saved = localStorage.getItem('theme') || 'light';
    setTheme(saved);
    btn.textContent = saved === 'dark' ? 'â˜€ï¸ Light Theme' : 'ğŸŒ™ Switch Theme';
    btn.onclick = function() {
        const newTheme = document.body.classList.contains('theme-dark') ? 'light' : 'dark';
        setTheme(newTheme);
        btn.textContent = newTheme === 'dark' ? 'â˜€ï¸ Light Theme' : 'ğŸŒ™ Switch Theme';
    };
    
    // Background Music Control
    bgMusic.volume = 0.15; // Set volume to 15% (quieter background music)
    bgMusic.play().catch(() => {
        console.log('Autoplay prevented. Music will start on user click.');
    });
    
    // Toggle music on/off
    musicToggle.onclick = function() {
        if (bgMusic.paused) {
            bgMusic.play();
            musicToggle.textContent = 'ğŸ”Š';
        } else {
            bgMusic.pause();
            musicToggle.textContent = 'ğŸ”‡';
        }
    };
    
    // Volume slider control
    volumeSlider.oninput = function() {
        bgMusic.volume = this.value / 100;
        localStorage.setItem('musicVolume', this.value);
    };
    
    // Load user's music volume preference
    const savedVolume = localStorage.getItem('musicVolume');
    if (savedVolume) {
        volumeSlider.value = savedVolume;
        bgMusic.volume = savedVolume / 100;
    }
    
    // Load music play/pause preference
    if (localStorage.getItem('musicEnabled') === 'false') {
        bgMusic.pause();
        musicToggle.textContent = 'ğŸ”‡';
    }
    
    // Save music state when toggled
    musicToggle.addEventListener('click', function() {
        localStorage.setItem('musicEnabled', !bgMusic.paused);
    });

    // Demo-only: stage selector to quickly test images and difficulty
    const stageSelect = document.getElementById('stage-select');
    const stageIndicator = document.getElementById('stage-indicator');
    const STAGE_TEXT = {
        1: 'Easy', 2: 'Normal', 3: 'Hard', 4: 'Hard', 5: 'Hard'
    };
    // Initialize from unlockedStage
    const unlocked = parseInt(localStorage.getItem('unlockedStage') || '1', 10);
    stageSelect.value = String(unlocked);
    stageIndicator.textContent = `ğŸ¯ Stage: ${stageSelect.value} | Difficulty: ${STAGE_TEXT[stageSelect.value]}`;
    stageSelect.addEventListener('change', () => {
        localStorage.setItem('unlockedStage', stageSelect.value);
        stageIndicator.textContent = `ğŸ¯ Stage: ${stageSelect.value} | Difficulty: ${STAGE_TEXT[stageSelect.value]}`;
        // Restart game to load new image
        if (typeof startGame === 'function') startGame();
    });
    
    // New Game button - start from Stage 1
    document.getElementById('newgame-btn').onclick = function() {
        localStorage.setItem('unlockedStage', '1');
        localStorage.removeItem('currentStage');
        if (typeof startGame === 'function') startGame();
    };
});
</script>
</body>
</html>
